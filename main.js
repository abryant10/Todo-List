(()=>{let t=JSON.parse(localStorage.getItem("taskStorage"))||[],e=JSON.parse(localStorage.getItem("listStorage"))||["Reminders"],i="all",a=JSON.parse(localStorage.getItem("completedTasks"))||[];function r(){var e=L.querySelector("[name=taskText]").value;if(""==e)return;const a=L.querySelector("[name=taskDueDate]").value,r=L.querySelector("[name=taskNotes]").value||"   ",n=L.querySelector("[name=listSelector]").value;var o=function(e){return t.filter((t=>t.list==e)).length+1}(n),s={title:e,list:n,notes:r,dueDate:a,listPriority:o,allPriority:t.length};t.push(s),l(),q(i),C.style.display="none",L.reset()}function n(){if(""!=m.querySelector("[name=addListText]").value){var t=f.value;e.push(t),m.reset(),m.style.display="none",o(),w(),$()}}function l(){localStorage.setItem("taskStorage",JSON.stringify(t))}function o(){localStorage.setItem("listStorage",JSON.stringify(e))}function s(){localStorage.setItem("completedTasks",JSON.stringify(a))}function d(){t.forEach((e=>{e.allPriority=t.indexOf(e)}))}function c(){a.forEach((e=>{e.allPriority=t.indexOf(e)}))}function u(e,i){t.forEach((t=>{t.list==e&&(t.listPriority<i||t.listPriority--)}))}function y(e){var i=P.value;let r,n=(new Date).toISOString().split("T")[0];switch(e){case"all":switch(i){case"priority":renderArray=t.slice().sort(((t,e)=>t.allPriority-e.allPriority))}break;case"today":switch(i){case"priority":r=t.filter((t=>t.dueDate==n)),renderArray=r.slice().sort(((t,e)=>t.allPriority-e.allPriority))}break;case"completed":switch(i){case"priority":renderArray=a.slice().sort(((t,e)=>t.allPriority-e.allPriority))}break;default:switch(i){case"priority":r=t.filter((t=>t.list==e)),renderArray=r.slice().sort(((t,e)=>t.listPriority-e.listPriority))}}return renderArray}const p=document.querySelector(".addListButton"),m=document.querySelector(".addListForm"),f=document.getElementById("addListText"),v=document.getElementById("allButton"),g=document.getElementById("todayButton"),T=document.getElementById("completedButton"),E=document.querySelector(".listNav"),h=document.querySelector(".newTaskButton"),P=document.getElementById("sortBySelector"),C=document.querySelector(".taskFormContainer"),L=document.querySelector(".taskForm"),k=document.getElementById("taskText"),x=document.getElementById("listSelector"),S=document.querySelector(".taskViewRenderDiv"),B=document.querySelector(".listDeletePopup"),D=B.querySelector(".listDeleteWarning"),I=document.getElementById("yesDeleteList"),b=document.getElementById("noDeleteList");function w(){x.innerHTML="",e.forEach((t=>{if(t==i){var e=document.createElement("option");(e=document.createElement("option")).innerHTML=`${t}`,e.selected="selected",x.appendChild(e)}else(e=document.createElement("option")).value=`${t}`,e.innerHTML=`${t}`,x.appendChild(e)}))}function $(){E.innerHTML="",e.forEach((t=>{var e=document.createElement("div");e.classList.add("navButton");var i=document.createElement("button");i.classList.add("listButton"),i.innerHTML=`${t}`;var a=document.createElement("button");a.innerHTML="X",a.classList.add("deleteListButton"),a.dataset.list=`${t}`,E.appendChild(e),e.appendChild(i),e.appendChild(a)}))}function q(t){var e=y(t);!function(){for(;S.firstChild;)S.removeChild(S.lastChild)}(),e.forEach((t=>{let e=`<input type="checkbox" class="TCCheck" data-index="${t.allPriority}">`,a=`<button class="TCButton TCPriorButton priorUp" data-index="${t.allPriority}">&#9650</button>\n            <button class="TCButton TCPriorButton priorDown" data-index="${t.allPriority}">&#9660</button>`,r="&nbsp;";""!=t.notes&&(r=t.notes),"completed"==i&&(e=""),"priority"!=P.value&&(a=""),newTaskCard=document.createElement("div"),newTaskCard.classList.add("taskCard"),newTaskCard.innerHTML=`<div class="TCTop">\n                <div class="TCTopLeft">\n                    ${e}\n                    <p class="TCTitle" data-index="${t.allPriority}">${t.title}</p>\n                </div>\n                <div class="TCTopRight">\n                    <input type="date" class="TCDate" value="${t.dueDate}">\n                    <div class="TCPriorityButtonContainer">\n                        ${a}\n                    </div>\n                    <button class="TCButton TCDelete" data-index="${t.allPriority}">X</button>\n                </div>\n            </div>\n            <div class="TCMiddle">\n                <button class="TCButton TCExpand" data-info="${t.allPriority}">info</button>\n            </div>\n            <div class="TCBottom" data-expand="${t.allPriority}">\n                <p>Notes:</p>\n                <div><p class="TCNotes" data-index="${t.allPriority}">${r}</p></div>\n                <p>List:</p>\n                <p class="TCList">${t.list}</p>\n            </div>`,S.appendChild(newTaskCard)}))}E.addEventListener("click",(function(t){t.target.matches(".listButton")&&(i=t.target.innerHTML,q(i),w())})),E.addEventListener("click",(function(t){if(t.target.matches(".deleteListButton"))return listToDelete=t.target.dataset.list,B.style.display="block",D.innerHTML=`Are you sure you want to delete ${listToDelete} and all of it's tasks?`,{listToDelete}})),I.addEventListener("click",(function(){e.splice(e.indexOf(listToDelete),1),o(),$(),w(),t.forEach((e=>{e.list==listToDelete&&t.splice(t.indexOf(e),1)})),d(),l(),q(i),B.style.display="none"})),b.addEventListener("click",(function(){B.style.display="none"})),v.addEventListener("click",(function(){i="all",q("all")})),g.addEventListener("click",(function(){i="today",q("today")})),T.addEventListener("click",(function(){i="completed",q("completed")})),S.addEventListener("click",(function(e){if(e.target.matches(".TCDelete"))if("completed"==i)a.splice(e.target.dataset.index,1),c(),s(),q(i);else{var r=t[e.target.dataset.index].list,n=t[e.target.dataset.index].listPriority;t.splice(e.target.dataset.index,1),d(),u(r,n),l(),q(i)}})),S.addEventListener("click",(function(e){if(e.target.matches(".priorUp")&&0!=e.target.dataset.index&&"today"!=i&&"completed"!=i){if("all"==i){var a=parseInt(e.target.dataset.index);t.forEach((t=>{t.allPriority<a-1||t.allPriority>a||(t.allPriority==a-1?t.allPriority++:t.allPriority==a&&t.allPriority--)}))}else{var r=t[parseInt(e.target.dataset.index)].listPriority;if(1==r)return;t.forEach((t=>{t.list==i&&(t.listPriority<r-1||t.listPriority>r||(t.listPriority==r-1?t.listPriority++:t.listPriority==r&&t.listPriority--))}))}t=t.sort(((t,e)=>t.allPriority-e.allPriority)),l(),q(i)}})),S.addEventListener("click",(function(e){if(e.target.matches(".priorDown")&&e.target.dataset.index!=t.length-1&&"today"!=i&&"completed"!=i){if("all"==i){var a=parseInt(e.target.dataset.index);t.forEach((t=>{t.allPriority<a||t.allPriority>a+1||(t.allPriority==a?t.allPriority++:t.allPriority==a+1&&t.allPriority--)}))}else{var r=t[parseInt(e.target.dataset.index)].listPriority;if(r==renderArray.length)return;t.forEach((t=>{t.list==i&&(t.listPriority<r||t.listPriority>r+1||(t.listPriority==r+1?t.listPriority--:t.listPriority==r&&t.listPriority++))}))}t=t.sort(((t,e)=>t.allPriority-e.allPriority)),l(),q(i)}})),S.addEventListener("click",(function(t){if(t.target.matches(".TCExpand")){var e=t.target.dataset.info,i=t.currentTarget.querySelector(`[data-expand="${e}"]`);i.classList.contains("expandedInfo")?i.classList.remove("expandedInfo"):i.classList.add("expandedInfo")}})),S.addEventListener("click",(function(e){if(e.target.matches(".TCCheck")){var r=t.splice(t[e.target.dataset.index],1);a=a.concat(r),s(),d(),u(),c(),l(),q(i)}})),S.addEventListener("click",(function(e){if(!e.target.matches(".TCTitle"))return;if("completed"==i)return;let a=e.target.dataset.index,r=e.target.parentElement;r.removeChild(e.target);let n=document.createElement("form");n.classList.add("TCchangeTitleForm");let l=document.createElement("input");l.type="text",l.classList.add("TCchangeTitleInput"),l.dataset.index=a,l.value=t[a].title,r.appendChild(n),n.appendChild(l)})),S.addEventListener("submit",(function(e){if(e.preventDefault(),!e.target.matches(".changeTitleForm"))return;let a=e.target.querySelector("input");t[a.dataset.index].title=a.value,l(),q(i)})),S.addEventListener("click",(function(e){if(!e.target.matches(".TCNotes"))return;if("completed"==i)return;let a=e.target.dataset.index,r=e.target.parentElement;r.removeChild(e.target);let n=document.createElement("form");n.classList.add("TCchangeNotesForm");let l=document.createElement("TEXTAREA");l.classList.add(".TCchangeNotesTextArea"),l.dataset.index=a,l.value=t[a].notes;let o=document.createElement("button");o.classList.add("TCNotesButton"),o.innerHTML="Save Changes",r.appendChild(n),n.appendChild(l),n.appendChild(o)})),S.addEventListener("click",(function(e){if(e.preventDefault(),!e.target.matches(".TCNotesButton"))return;let a=e.target.parentElement.querySelector("textarea");t[a.dataset.index].notes=a.value,l(),q(i)})),p.addEventListener("click",(()=>{n(),m.reset(),m.style.display="block",f.focus(),f.focus()})),m.addEventListener("submit",(t=>{t.preventDefault(),n()})),h.addEventListener("click",(()=>{r(),L.reset(),w(),C.style.display="block",k.focus()})),P.addEventListener("change",(()=>{q(i)})),L.addEventListener("submit",(t=>{t.preventDefault(),r()})),window.addEventListener("keydown",(function(t){"Escape"===t.key&&(L.reset(),C.style.display="none",m.reset(),m.style.display="none",q(i))})),window.addEventListener("keydown",(function(t){"block"==C.style.display&&"Enter"===t.key&&r()})),w(),$(),q("all")})();